{% extends 'bootstrap/base.html' %}

{% block styles %}
    {{ super() }}
    {% assets "application_css" %}
        <link rel="stylesheet" href="{{ ASSET_URL }}"/>
    {% endassets %}
    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            width: 100%;
            height: 100%;
        }
    </style>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>
        APP_IMAGES_URL = "{{ url_for('static', filename='images')}}"
    </script>
    {% assets "application_js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
{% endblock %}

{% block content %}
    <div id="map-control-panel"></div>
    <div id="map"></div>
    <div id="sidebar"></div>
    <div id="transnet-sidebar">
        {% include 'transnetfilter.html' %}
    </div>

    {% raw %}
    <script id="marker-sidebar-template" type="text/x-handlebars-template">
        <div class="sidebar"><h1>Point {{ id }}</h1></div>
        <div><p><strong>LatLng:</strong> {{ latlng }}</p>
            <p><strong>Tags:</strong> {{ json tags }}</p>
            {{#each pictures}}
            <img src="{{ this.filepath }}">
            {{/each}}
            <p><a href="index?point_id={{ id }}&lat={{ latlng.[0] }}&long={{ latlng.[1] }}&zoom=18">Permalink</a></p>
            <p><a href="/admin/points/edit/{{id}}?redirect_back=true">
                <button class="btn btn-default">Edit</button>
            </a></p>
        </div>
        <br/>
        OSM-ID:
        <!-- OSMAPI_DOMAIN config variable needs to be rendered by Jinja2
        templates. So do +endraw+ statement, print the config variable
        and open +raw+ statement -->
        <a href="http://{% endraw %}{{ config['OSMAPI_CONFIG']['domain'] }}{% raw %}/node/{{ osmid }}"
           target="_blank">
            {{ osmid }}
        </a>
    </script>
    {% endraw %}
    {% raw %}
    <script id="polyline-popup-template" type="text/x-handlebars-template">
        <div class="panel panel-default">
            <div class="panel-heading">Powerline {{ id }}</div>
            <div class="panel-body">
                <p><strong>Tags:</strong> {{ json tags }}</p>
                <p><a href="/admin/powerlines/edit/{{id}}?redirect_back=true">
                    <button class="btn btn-default">Edit</button>
                </a></p>
            </div>
        </div>
    </script>
    {% endraw %}
    {% raw %}
    <script id="relation-sidebar-template" type="text/x-handlebars-template">
        <div class='relation-sidebar'>
            <div class="sidebar"><h1>Relation: OSM-ID-{{ relation.properties.osmid }}</h1></div>
            <hr/>
            <div class="sidebar-tags-table">
                <strong>Tags:</strong>
                <table>
                    <tr>
                        <th>Tag</th>
                        <th>Value</th>
                    </tr>
                    {{#each relation.properties.tags}}
                    <tr>
                        <td>{{@key}}:</td>
                        <td>{{this}}</td>
                    </tr>
                    {{/each}}
                </table>
            </div>
            <hr/>
            <div>
                {{relationSelectionButton}}
                <br/>
                <br/>
                {{relationSelectionSummaryAndActions}}
            </div>
            {{#if relation.points}}
            <hr>
            <div class="sidebar-tags-table">
                <strong>Stations:</strong>
                {{#each relation.points}}
                <hr>
                <table>
                    <tr>
                        <th>Tag</th>
                        <th>Value</th>
                    </tr>
                    {{#each this.properties.tags}}
                    <tr>
                        <td>{{@key}}:</td>
                        <td>{{this}}</td>
                    </tr>
                    {{/each}}
                </table>
                {{/each}}

            </div>
            {{/if}}
            {{#if relation.powerlines}}
            <hr>
            <div class="sidebar-tags-table">
                <strong>Power Lines:</strong>
                {{#each relation.powerlines}}
                <hr>
                <table>
                    <tr>
                        <th>Tag</th>
                        <th>Value</th>
                    </tr>
                    {{#each this.properties.tags}}
                    <tr>
                        <td>{{@key}}:</td>
                        <td>{{this}}</td>
                    </tr>
                    {{/each}}
                </table>
                {{/each}}

            </div>
            {{/if}}
        </div>
    </script>

    <script id="statistic-sidebar-template" type="text/x-handlebars-template">
        <div class="sidebar"><h1>Statistics</h1></div>
        <div>

            {{#unless numPowerElements.markers}}
            {{#if numPowerElements.clusteredMarkers}}
            <strong>clustered Markers:</strong> {{ numPowerElements.clusteredMarkers }} <br>
            Please zoom in to get more details!
            {{else}}
            <strong>No markers inside this area.</strong>
            {{/if}}
            {{else}}
            <strong>All markers:</strong> {{ numPowerElements.markers }}
            <ul>
                {{#if numPowerElements.transformers}}
                <li><strong>Transformers:</strong> {{ numPowerElements.transformers }}</li>
                {{/if}}
                {{#if numPowerElements.substations}}
                <li><strong>Substations:</strong> {{ numPowerElements.substations }}</li>
                {{/if}}
                {{#if numPowerElements.powerPoles}}
                <li><strong>Power poles:</strong> {{ numPowerElements.powerPoles }}</li>
                {{/if}}
                {{#if numPowerElements.powerTowers}}
                <li><strong>Power towers:</strong> {{ numPowerElements.powerTowers }}</li>
                {{/if}}
                {{#if numPowerElements.powerPlants}}
                <li><strong>Power plants:</strong> {{ numPowerElements.powerPlants }}</li>
                {{/if}}
                {{#if numPowerElements.windPower}}
                <li><strong>Wind power:</strong> {{ numPowerElements.windPower }}</li>
                {{/if}}
                {{#if numPowerElements.solarPower}}
                <li><strong>Solar power:</strong> {{ numPowerElements.solarPower }}</li>
                {{/if}}
                {{#if numPowerElements.waterPower}}
                <li><strong>Water power:</strong> {{ numPowerElements.waterPower }}</li>
                {{/if}}
                {{#if numPowerElements.otherGenerators}}
                <li><strong>Other generators:</strong> {{ numPowerElements.otherGenerators }}</li>
                {{/if}}
                {{#if numPowerElements.others}}
                <li><strong>Other power related markers:</strong> {{ numPowerElements.others }}</li>
                {{/if}}
            </ul>
            {{/unless}}
        </div>
        <div>
            <strong>All powerlines:</strong> {{ numberOfPowerlines }}
            {{#if numberOfPowerlines}}
            <ul>
                <li><strong>Length of all visible parts of powerlines:</strong> {{ lengthOfPowerlines.all }}</li>
                <li>
                    <strong>Length by voltage</strong>
                    <ul>
                        {{#each lengthOfPowerlines.voltage}}
                        <li><strong>{{@key}}:</strong> {{this}}</li>
                        {{/each}}
                    </ul>
                </li>
            </ul>
            {{/if}}
        </div>

    </script>

    {% endraw %}
{% endblock %}
